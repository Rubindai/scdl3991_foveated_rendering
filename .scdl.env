# ================= SCDL Pipeline Config (.scdl.env) =================
# This file is auto-loaded by run_windows_blender_wsl.sh from the repo root.
# Edit values here to control preview, DINO, and final render behavior.

# -------- Project / Paths --------
# WSL path to the project root (defaults to script dir if unset)
SCDL_PROJECT_DIR=/home/rubin/uni/scdl3991_foveated_rendering

# WSL path to Windows Blender executable
BLENDER_EXE=/mnt/d/Programs/blender/blender.exe

# Blend file to open (you can also pass as first arg to the launcher)
BLEND_FILE=blender_files/office.blend


# -------- Mask Generation (DINO) --------

# DINO repo/weights (local clone + weights path).
SCDL_DINO_REPO=/home/rubin/uni/scdl3991_foveated_rendering/dinov3
# SCDL_DINO_WEIGHTS=/home/rubin/uni/scdl3991_foveated_rendering/dinov3_vits16_pretrain_lvd1689m-08c60483.pth
SCDL_DINO_WEIGHTS=/home/rubin/uni/scdl3991_foveated_rendering/dinov3_vitl16_pretrain_lvd1689m-8aa4cbdd.pth
# Backbone: vitl16 (highest quality, default) or vits16 (faster with minor loss).
SCDL_DINO_ARCH=vitl16

# ----- Saliency inference -----
# Multi-scale input sizes; set to "auto" for resolution-aware selection.
SCDL_MASK_SCALES=auto
# Combine strategy for multi-scale maps: mean | max | median | weighted
SCDL_MASK_REDUCE=mean
# Optional weights (match SCDL_MASK_SCALES when using weighted reduce, e.g. 0.2,0.3,0.5)
# SCDL_MASK_SCALE_WEIGHTS=
# Peak emphasis; higher => sparser/Sharper saliency.
SCDL_MASK_GAMMA=2.0
# Saliency smoothing kernel; 1 = OFF (max sharpness).
SCDL_MASK_SMOOTH_K=1
# Mixed precision on CUDA for speed (ignored on CPU).
SCDL_MASK_AMP=1
# Allow TF32 math on CUDA (1=on, 0=off)
SCDL_MASK_ALLOW_TF32=1
# Force device (e.g. cuda:0, cuda:1, cpu); leave blank for auto
# SCDL_MASK_DEVICE=
# Gaussian blur applied before saving the EXR mask (prevents hard seams).
SCDL_MASK_BLUR_SIGMA=1.5

# ----- GrabCut refinement (edge-aware snap to contours) -----
# Enable GrabCut refinement (requires OpenCV).
SCDL_MASK_USE_GRABCUT=1
# Iterations (more = stronger snap). Use "auto" to adapt by resolution.
SCDL_MASK_GRABCUT_ITERS=auto
# Seed thresholds from saliency quantiles (foreground / background).
SCDL_GC_LO_Q=0.20
SCDL_GC_HI_Q=0.80
# Pixels at image border forced to background (helps avoid spillover).
SCDL_GC_BORDER=8

# ----- Secondary refinement (watershed segmentation) -----
# Produces tight, single-object masks when DINO is diffuse.
SCDL_MASK_WATERSHED=1
SCDL_WS_LO_Q=0.30
SCDL_WS_HI_Q=0.92
SCDL_WS_BORDER=6
SCDL_WS_KERNEL=5
SCDL_WS_FG_CLOSE=1
SCDL_WS_BG_OPEN=1
SCDL_WS_SEG_CLOSE=0
SCDL_WS_BLEND=0.45
SCDL_WS_BLUR=0.8

# pick ONE focus mode
SCDL_FOCUS_MODE=defocus        # defocus (mask-driven bokeh), blur (fast gaussian), dof (camera), off

# defocus (compositor) knobs â€” applied when SCDL_FOCUS_MODE=defocus
SCDL_DEFOCUS_FSTOP=4
# lower => stronger blur; scales mask response
SCDL_DEFOCUS_ZSCALE=1.0
# controls how quickly blur grows outside the fovea
SCDL_DEFOCUS_MAXBLUR=32.0
# pixel radius cap; reused by blur fallback

# camera DOF knobs (only used if SCDL_FOCUS_MODE=dof)
SCDL_FOCUS_FSTOP=1.8           # lower = stronger bokeh
SCDL_FOCUS_DISTANCE=2.0        # meters; ignored if focus object is set
SCDL_FOCUS_OBJECT=             # optional: name of an object to focus on




# -------- Notes --------
# - Preview resolution keeps the .blend render aspect automatically; adjust short side in blender_steps.py if needed.
# - The final render is single-pass; tune SCDL_FOVEATED_* knobs to trade render time for detail in salient regions.

# -------- Preview (Blender) --------
# Short side of preview in pixels (aspect preserved)
SCDL_PREVIEW_SHORT=448
# Cycles spp for preview fallback
SCDL_PREVIEW_SPP=16
# Denoise the preview before passing to DINO (0=No, 1=Yes). Helps DINO see structure in noisy renders.
SCDL_PREVIEW_DENOISE=1
# Adaptive sampling threshold for preview; higher = faster / noisier (blank = Blender default)
SCDL_PREVIEW_ADAPTIVE_THRESHOLD=0.04
# Optional minimum samples for adaptive sampling (blank = Blender default)
# SCDL_PREVIEW_MIN_SPP=4
# Optional preview noise controls (safe for saliency; reduce fireflies/noise)
# Disable caustics in preview (0=off, 1=on); off reduces noise and matches final defaults
SCDL_PREVIEW_CAUSTICS=0
# Mild Filter Glossy to calm specular noise (blank to leave default)
SCDL_PREVIEW_BLUR_GLOSSY=0.2
# Optional light clamping (set only if needed; blank leaves defaults)
# SCDL_PREVIEW_CLAMP_DIRECT=10
# SCDL_PREVIEW_CLAMP_INDIRECT=10
# Cycles device override for headless Blender sessions (CPU, GPU, CUDA, OPTIX, etc.)
SCDL_CYCLES_DEVICE=OPTIX

# -------- Logging --------
# Options: stdout | file | both
SCDL_LOG_MODE=both
# Optional explicit log path (defaults to out/scdl_pipeline.log)
# SCDL_LOG_FILE=/path/to/pipeline.log

# -------- Final render (Blender) --------
SCDL_FOVEATED_BASE_SPP=192
SCDL_FOVEATED_MAX_SPP=768
SCDL_FOVEATED_MIN_SPP=32
SCDL_ADAPTIVE_THRESHOLD=0.03
# Auto scale single-pass samples based on mask coverage (1=enable)
SCDL_FOVEATED_AUTOSPP=1
