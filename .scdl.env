# ================= SCDL Pipeline Config (.scdl.env) =================
# This file is auto-loaded by run_windows_blender_wsl.sh from the repo root.
# Edit values here to control preview, DINO, export, and final render behavior.

# -------- Project / Paths --------
# WSL path to the project root (defaults to script dir if unset)
SCDL_PROJECT_DIR=/home/rubin/uni/scdl3991

# WSL path to Windows Blender executable
BLENDER_EXE=/mnt/d/Programs/blender/blender.exe

# Blend file to open (you can also pass as first arg to the launcher)
BLEND_FILE=blender_files/cookie.blend


# -------- Mask / ROI Generation (DINO) --------
# Fraction of pixels to keep as ROI when deriving the bbox from the mask (0.05–0.35 typical)
SCDL_ROI_AREA=0.20

# Weight for mask generation: 0=edge+CLS → more CLS saliency, 1=edge+CLS → more edges
SCDL_MASK_EDGE_WEIGHT=0.5

# DINO repo/weights (override here if paths differ)
SCDL_DINO_REPO=/home/rubin/uni/scdl3991/dinov3
SCDL_DINO_WEIGHTS=/home/rubin/uni/scdl3991/dinov3_vits16_pretrain_lvd1689m-08c60483.pth


# -------- Final Path Selection --------
# 0 = Blender ROI composite (default, fast and stable on Windows GPU)
# 1 = LuxCore WSL final (single session; can use per-pixel importance when supported)
SCDL_USE_WSL_FINAL=0


# -------- LuxCore (WSL) Final (only when SCDL_USE_WSL_FINAL=1) --------
# Try GPU via PATHOCL; falls back to CPU if device/platform is unavailable
SCDL_USE_GPU=0

# Halting: time (sec), eye-only spp cap, noise threshold (higher = stops sooner)
SCDL_HALTTIME=60
SCDL_HALTSPS=400
SCDL_HALTTHRESH=0.06

# Noise estimation cadence
SCDL_NOISE_WARMUP=32
SCDL_NOISE_STEP=32

# Optional film size override for LuxCore final (otherwise uses render.cfg)
SCDL_FINAL_W=1024
SCDL_FINAL_H=1024

# USER_IMPORTANCE injection for LuxCore:
# 1 = write mask to file (EXR/PNG) and set properties before RenderConfig (works even without Film API)
# 0 = rely on runtime Film API (UpdateOutput/SetOutput/SetChannel); if unsupported, renders unweighted
SCDL_IMPORTANCE_FROM_FILE=1

# Optional absolute path for the importance map file; if empty, the script writes into out/
SCDL_IMPORTANCE_FILE=

# Floor for importance map values to avoid starving regions (0..1, e.g., 0.2)
SCDL_IMPORTANCE_MIN=0.2


# -------- Notes --------
# - The launcher sets SCDL_CFG_PATH automatically to the exact exported render.cfg location.
# - Preview resolution keeps the .blend render aspect automatically; adjust short side in blender_steps.py if needed.
# - For feathered edges in the Blender ROI composite, ask to switch to a matte-based blend using the saved mask.

# -------- Preview / Export (Blender) --------
# Short side of preview in pixels (aspect preserved)
SCDL_PREVIEW_SHORT=448
# Cycles spp for preview fallback
SCDL_PREVIEW_SPP=16
# Denoise the preview before passing to DINO (0=No, 1=Yes). Helps DINO see structure in noisy renders.
SCDL_PREVIEW_DENOISE=1
# Export-time header resolution for FileSaver (LuxCore)
SCDL_EXPORT_RES_X=1024
SCDL_EXPORT_RES_Y=1024

# Cycles device override for headless Blender sessions (CPU, GPU, CUDA, OPTIX, etc.)
SCDL_CYCLES_DEVICE=CUDA

# -------- Logging --------
# Options: stdout | file | both
SCDL_LOG_MODE=both
# Optional explicit log path (defaults to out/scdl_pipeline.log)
# SCDL_LOG_FILE=/path/to/pipeline.log

# -------- ROI render knobs (Blender path) --------
# LuxCore ROI halting (used when LuxCore is available in Blender)
SCDL_ROI_LUX_SPP=800
SCDL_ROI_LUX_TIME=120
SCDL_ROI_LUX_NOISE=0.06
# Cycles ROI (fallback)
SCDL_ROI_CYCLES_SPP=512
SCDL_ROI_CYCLES_ADAPTIVE=1
SCDL_ROI_CYCLES_THRESHOLD=0.05
